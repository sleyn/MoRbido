{
    "collab_server" : "",
    "contents" : "library(MoRbido)\nsetwd(\"/Users/semenleyn/Documents/WORK/Genomics/Tasks/Task20 (Experimental Evolution)/!Runs/Run (Claudia drugs)/Run 2110_2 compound 12.jul.2018/Morbidostat curves/\")\n\ntables_2110_2 <- calculate_tables(\n  dil_check = T,\n  bc_check = T,\n  C0 = 0,\n  CS1 = 0,\n  CS2 = 2,\n  V = 20,\n  dV = 2,\n  od_file=\"7-16-2018-OD.txt\",\n  pump_file=\"7-16-2018-pumps.txt\",\n  dil_file=\"dilutions.txt\",\n  bc_file = \"bottle_change.txt\",\n  tubes_selected = c(1,3,4,5,6),\n  zero = c(Tube1 = -0.06, Tube3 = -0.01, Tube4 = 0.03, Tube5 = 0.01, Tube6 = 0)\n  )\ntables_2110_2.col <- collapse.to.middle(tables_2110_2)\ntables_2110_2.cum <- cumulative(tables_2110_2)\ntables_2110_2.gr <- growth.rates(tables_2110_2,MIC = 0.156)\n\n#Cut contaminated part\nfor( n in names(tables_2110_2.col) ){\n  tables_2110_2.col[[n]]$OD = tables_2110_2.col[[n]]$OD[tables_2110_2.col[[n]]$OD$time < 70 * 3600,]\n  tables_2110_2.col[[n]]$Conc = tables_2110_2.col[[n]]$Conc[tables_2110_2.col[[n]]$Conc$time < 70 * 3600,]\n}\n\n#Plotting\nparams = get_draw_parameters(CS2 = 2, od_file=\"7-16-2018-OD.txt\")\ndraw(tables_2110_2.col, MIC = 0.156, params = params)\n#draw(tables_2110_2.cum, MIC = 0.156)\n\n#Mutation plots\nmutability(tables_2110_2, tables_2110_2.gr, tables_2110_2.col, tables_2110_2.cum, time.window = c(23,28), tube = \"Tube1\", MIC = 0.156)\nmutability(tables_2110_2, tables_2110_2.gr, tables_2110_2.col, tables_2110_2.cum, time.window = c(15,20), tube = \"Tube5\", MIC = 0.156)\nmutability(tables_2110_2, tables_2110_2.gr, tables_2110_2.col, tables_2110_2.cum, time.window = c(23,28), tube = \"Tube6\", MIC = 0.156)\n\n#Running Conc-GR\n\nlibrary(ggplot2)\nlibrary(gridExtra)\nlibrary(patchwork)\n\nt = data.frame(gr = tables_2110_2.gr$Tube1$growth.rate, time = tables_2110_2.gr$Tube1$time, conc = tables_2110_2.col$Tube1$Conc$Concentration[-length(tables_2110_2.col$Tube1$Conc$Concentration)])\nt$gr = t$gr + 0.01\nt$conc = t$conc + 0.01\nt.temp = t[t$time > 0 & t$time < 6,]\nt.fit = lm(conc ~ poly(gr,4,raw = T) ,data = t.temp)\n\nl = data.frame(c.av = mean(t.temp$conc), ic50 = predict(t.fit, data.frame(gr = max(t.temp$gr)*0.1)), time = 2)\nx = ggplot(t.temp,aes(gr,conc)) + geom_point(aes(colour = time)) + geom_line(data = data.frame(gr = t.temp$gr, conc = predict(t.fit,gr = t.temp$gr)))\n\nfor( i in seq(9,ceiling(max(t$time)),3)){\n  t.temp = t[t$time > i-6 & t$time < i,]\n  t.fit = lm(conc ~ poly(gr,4,raw = T) ,data = t.temp)\n  l = rbind(l,data.frame(c.av = mean(t.temp$conc), ic50 = predict(t.fit, data.frame(gr = max(t.temp$gr)*0.1)), time = i-2))\n  p = ggplot(t.temp, aes(gr,conc)) + geom_point(aes(colour = time)) + geom_line(data = data.frame(gr = t.temp$gr, conc = predict(t.fit,gr = t.temp$gr)))\n  x = x + p\n}\n\nl = l[l$ic50 >= 0.1,]\nx + plot_layout(ncol = 3)\nplot(l$time,log(l$ic50/0.156))\nplot(l$time,log(l$c.av/0.156))\n\n#Modelling influece of cycle time\n\ndowncount = function(dt = 0.1, n0 = 0.5, k = 10, dil = 0.8, u = 1.5){\n  return(n0 / ( dil^k * exp(k * u * dt) ))\n}\n\nx = ggplot()\ncbbPalette <- c(\"#000000\", \"#E69F00\", \"#56B4E9\", \"#009E73\", \"#F0E442\", \"#0072B2\", \"#D55E00\", \"#CC79A7\")\nc = 1\n\nfor( dt in c(0.15,0.2, 0.23, 0.25,0.5,1)){\n  k = 1\n  t = 10 - dt\n  od = data.frame(time = c(10), n = c(0.5))\n  for( i in seq(dt,10,dt) ){\n    n.prev = downcount(dt = dt, k = k)\n    od = rbind(od,data.frame(time = t, n = n.prev))\n    k = k + 1\n    t = t - dt\n  }\n  print(tail(od,1))\n  x = x + geom_point(data = od, aes(time, n), colour = cbbPalette[c])\n  c = c + 1\n}\n\nx\n",
    "created" : 1541020337387.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "536245653",
    "id" : "B550852B",
    "lastKnownWriteTime" : 1540925216,
    "last_content_update" : 1540925216,
    "path" : "~/Documents/WORK/Genomics/Tasks/Task20 (Experimental Evolution)/!Runs/Run (Claudia drugs)/Run 2110_2 compound 12.jul.2018/Morbidostat curves/Draw curves_dil_bc_func_modular.R",
    "project_path" : null,
    "properties" : {
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}